SELECT
    qsqt.query_id,
    qsqt.query_sql_text,
    qsrs.avg_duration,
    qsrs.last_execution_time,
    qsrs.execution_type_desc,
    qsrs.count_executions
FROM
    sys.query_store_query_text AS qsqt
    INNER JOIN sys.query_store_query AS qsq
        ON qsqt.query_text_id = qsq.query_text_id
    INNER JOIN sys.query_store_runtime_stats AS qsrs
        ON qsq.query_id = qsrs.query_id
WHERE
    qsqt.query_sql_text LIKE '%YourStoredProcName%';


DECLARE @text NVARCHAR(MAX) = '%SELECT%FROM%YourTable%' -- Replace with your stored procedure or dynamic SQL snippet

SELECT
    qsq.query_id,
    qsqt.query_sql_text,
    qsq.last_execution_time,
    AVG(qsrs.avg_duration) / 1000000 AS avg_execution_time_s,
    MAX(qsrs.max_duration) / 1000000 AS max_execution_time_s,
    SUM(qsrs.execution_count) AS execution_count
FROM
    sys.query_store_query qsq
    INNER JOIN sys.query_store_query_text qsqt ON qsq.query_text_id = qsqt.query_text_id
    INNER JOIN sys.query_store_runtime_stats qsrs ON qsq.query_id = qsrs.query_id
WHERE
    qsqt.query_sql_text LIKE @text
GROUP BY
    qsq.query_id,
    qsqt.query_sql_text,
    qsq.last_execution_time
ORDER BY
    avg_execution_time_s DESC;
